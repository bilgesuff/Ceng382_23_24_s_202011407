@page
@model MyApp.Namespace.ShowReservationsModel
@{
    ViewData["Title"] = "Reservations";
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Show Reservations</title>
    <link rel="stylesheet" href="~/css/site.css">
    <link rel="stylesheet" href="~/css/ShowReservation.css">
</head>
<body>
    <section class="form">
        <h1 class="header1">Reservations</h1>
        <form method="get">
            <div>
                <label for="roomNameFilter">Name of Room:</label>
                <input id="roomNameFilter" name="RoomNameFilter" type="text" class="form-control" value="@Model.RoomNameFilter">
            </div>
            <div>
                <label for="startDateFilter">Date:</label>
                <input id="startDateFilter" name="StartDateFilter" type="date" class="form-control" value="@Model.StartDateFilter?.ToString("yyyy-MM-dd")">
            </div>
            <div>
                <label for="capacityFilter">Capacity:</label>
                <input id="capacityFilter" name="CapacityFilter" type="number" class="form-control" value="@Model.CapacityFilter">
            </div>
            <div>
                <button type="submit" class="btn btn-primary">Filter</button>
            </div>
            <div>
                <label for="weekSelect">Weeks:</label>
                <select id="weekSelect" name="SelectedWeek" class="form-control" onchange="this.form.submit()">
                    @foreach (var week in Model.Weeks)
                    {
                        if (week == Model.SelectedWeek)
                        {
                            <option value="@week.ToString("yyyy-MM-dd")" selected>@week.ToString("dd MMM yyyy") - @week.AddDays(6).ToString("dd MMM yyyy")</option>
                        }
                        else
                        {
                            <option value="@week.ToString("yyyy-MM-dd")">@week.ToString("dd MMM yyyy") - @week.AddDays(6).ToString("dd MMM yyyy")</option>
                        }
                    }
                </select>
            </div>
        </form>
    </section>

    <table class="timetable">
        <thead>
            <tr>
                <th>Time</th>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Saturday</th>
                <th>Sunday</th>
            </tr>
        </thead>
        <tbody>
            @for (int hour = 9; hour < 18; hour++)
            {
                <tr>
                    <td>@hour:00</td>
                    @for (int day = 0; day < 7; day++)
                    {
                        var currentDate = Model.SelectedWeek.AddDays(day).ToString("yyyy-MM-dd");
                        <td>
                            @if (Model.WeeklyReservations.ContainsKey(currentDate) && Model.WeeklyReservations[currentDate].Any(r => r.Time.Hour == hour))
                            {
                                @foreach (var reservation in Model.WeeklyReservations[currentDate].Where(r => r.Time.Hour == hour))
                                {
                                    <div>
                                        Room: @reservation.Room.RoomName <br />
                                        Reserver: @reservation.ReserverName <br />
                                        Time: @reservation.Time.ToString("HH:mm") <br />
                                        <div class="actions">
                                            <form method="post" asp-page-handler="Edit">
                                                <input type="hidden" name="id" value="@reservation.Id" />
                                                <button type="submit" class="btn btn-primary">Edit</button>
                                            </form>
                                        </div>
                                    </div>
                                    <hr />
                                }
                            }
                        </td>
                    }
                </tr>
            }
        </tbody>
    </table>
</body>
</html>
